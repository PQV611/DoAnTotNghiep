<div class="order-manager">
    <h2>Quản lý đơn hàng</h2>
  
    <!-- Filter ngày -->
    <!-- <div class="date-filter">
      <label>Từ ngày: <input type="date" [(ngModel)]="fromDate" /></label>
      <label>Đến ngày: <input type="date" [(ngModel)]="toDate" /></label>
    </div> -->
  
    <!-- Tabs trạng thái -->
    <!-- <ul class="order-tabs">
      <li [class.active]="activeTab === 'pending'" (click)="changeTab('pending')">
        Chờ phê duyệt <span *ngIf="countPendding > 0">({{ countPendding }})</span>
      </li>
      <li [class.active]="activeTab === 'shipping'" (click)="changeTab('shipping')">
        Đang giao hàng <span *ngIf="countShipping > 0">({{ countShipping }})</span>
      </li>
      <li [class.active]="activeTab === 'completed'" (click)="changeTab('completed')">
        Hoàn thành <span *ngIf="countCompleted > 0">({{ countCompleted }})</span>
      </li>
      <li [class.active]="activeTab === 'cancelled'" (click)="changeTab('cancelled')">
        Đã huỷ
      </li>
    </ul> -->

    <select title="1" [(ngModel)]="selectedStatus" (change)="changeStatus(selectedStatus)">
    <option [value]="0">Tất cả trạng thái</option>
    <option [value]="1">Chờ phê duyệt</option>
    <option [value]="2">Đang giao hàng</option>
    <option [value]="3">Giao hàng thành công</option>
    <option [value]="4">Đã huỷ</option>
  </select>
      <!-- chọn số lượng sản phẩm / trang -->
    <!-- Dropdown phân trang -->
    <select title="1" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
      <option [value]="6">6 / trang</option>
      <option [value]="10">10 / trang</option>
      <option [value]="20">20 / trang</option>
    </select>
      
    </div>
    <div class="alert-bar" *ngIf="alertMessage">
      {{ alertMessage }}
    </div>
  
    <!-- Bảng danh sách đơn hàng -->
    <table class="order-table" style="background-color: white;">
      <thead>
        <tr>
          <th>Mã đơn</th>
          <th>Mã KH</th>
          <th>Tên khách hàng</th>
          <th>Chi tiết</th>
          <th>Địa chỉ</th>
          <th>Tổng tiền</th>
          <th>Phương thức</th>
          <th>Ngày tạo</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <!-- Chỗ đoạn này là dùng this.orders luôn, nên là các trường phải đúng như trong entity -->
        <tr *ngFor="let order of orders">
          <td>{{ order.idOrder }}</td>
          <td>{{ order.idUser }}</td>
          <td>{{ order.fullname }}</td>
          <td><i class="bi bi-eye-fill" style="cursor: pointer;" (click)="viewDetail(order)"></i></td>
          <td>{{ order.address }}</td>
          <td>{{ order.totalCost | number }}đ</td>
          <td>{{ order.paymentMethod }}</td>
          <td>{{ order.createAt }}</td>
          <td>
            <span [ngClass]="{ 'text-danger': order.status === 1 || order.status === 4, 'text-success': order.status === 2 || order.status === 3 }">
                {{ order.statusText }}
              </span>
          </td>
          <td>
            <ng-container [ngSwitch]="order.status">
              <ng-container *ngSwitchCase="1">
                <button (click)="approveOrder(order)" class="btn btn-success">Phê duyệt</button>
                &nbsp;
                <button (click)="rejectOrder(order)" class="btn btn-danger">Không phê duyệt</button>
              </ng-container>
              <ng-container *ngSwitchCase="2">
                <button (click)="markAsDelivered(order)" class="btn btn-success">Giao thành công</button>
              </ng-container>
              <ng-container *ngSwitchDefault> - </ng-container>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  
<!-- <div class="pagination">
  <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 0">Prev</button>
  <button *ngFor="let page of [].constructor(totalPages); let i = index"
          (click)="changePage(i)"
          [class.active]="i === currentPage">
    {{ i + 1 }}
  </button>
  <button (click)="changePage(currentPage + 1)" [disabled]="currentPage + 1 >= totalPages">Next</button>
</div> -->
<div class="pagination">
    <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 0">
      <i class="bi bi-chevron-left"></i>
    </button>

    <button
      *ngFor="let page of pageNumbers"
      [class.active]="page === currentPage"
      (click)="changePage(page)">
      {{ page + 1 }}
    </button>

    <button (click)="changePage(currentPage + 1)" [disabled]="currentPage + 1 >= totalPages">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>

    <!-- Modal xem chi tiết -->
<div class="modal-overlay" *ngIf="isDetailModalOpen">
    <div class="modal modal-large">
      <h3>Chi tiết đơn hàng - {{ selectedOrder?.idOrder }}</h3>
  
      <table class="detail-table">
        <thead>
          <tr>
            <th>Ảnh</th>
            <th>Tên sản phẩm</th>
            <th>Số lượng</th>
            <th>Giá</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of selectedOrder?.orderItemList">
            <td><img title="123" [src]="item.imageUrl" width="80" height="100" /></td>
            <td>{{ item.productName }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.price | number }}đ</td>
          </tr>
        </tbody>
      </table>
  
      <div class="modal-actions">
        <button class="btn btn-cancel" style="background-color: red; color: white;" (click)="closeDetailModal()">Đóng</button>
      </div>
    </div>
  </div>
  
  